<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ seo.title }}</title>
    <meta name="description" content="{{ seo.description }}" />
    <link rel="canonical" href="{{ seo.canonical }}" />

    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ seo.ogTitle or seo.title }}" />
    <meta property="og:description" content="{{ seo.ogDescription or seo.description }}" />
    <meta property="og:url" content="{{ seo.canonical }}" />
    {# og:image: prefer URL absoluta (melhor compatibilidade com crawlers) #}
    {% set _og = (seo.ogImage or site.defaultOgImage) %}
    {% if _og and (_og | slice(0,1)) == "/" %}
      {# site.siteUrl já é canônico e sem "/" no final neste projeto #}
      {% set _ogAbs = site.siteUrl ~ _og %}
    {% else %}
      {% set _ogAbs = _og %}
    {% endif %}
    <meta property="og:image" content="{{ _ogAbs }}" />

    {% if publish.mode != "production" %}
      <meta name="robots" content="noindex,nofollow" />
    {% else %}
      <meta name="robots" content="index,follow" />
    {% endif %}

    {# favicon (SERP): Google costuma preferir PNG/ICO. Publicamos PNG em / (src/static → /). #}
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/assets/site.css" />
  </head>
  <body data-page-type="{{ pageMeta.type or 'home' }}" data-city-slug="{{ pageMeta.citySlug or '' }}">
    <header class="top">
      <div class="wrap">
        <a class="brand" href="/">{{ site.brandName }}</a>
        {% set t = pageMeta.type or '' %}
        {% if t == "home" or t == "cidades" or t == "legal_privacy" or t == "legal_terms" %}
          <nav class="nav">
            <a href="#contato">Contato</a>
          </nav>
        {% else %}
          <nav class="nav">
            <a class="navCta" data-ct-wa="1" data-wa-kind="topbar" href="https://wa.me/{{ site.whatsAppNumberE164 | replace('+','') | replace(' ','') | replace('-','') | replace('(','') | replace(')','') }}?text={{ (site.whatsAppDefaultText or '') | urlencode }}">WhatsApp</a>
          </nav>
        {% endif %}
      </div>
    </header>

    <main class="main">
      {{ content | safe }}
    </main>

    <footer class="footer" id="contato">
      <div class="wrap">
        <div class="footerRow">
          <div class="muted">© {{ ("" | toISODate) | slice(0,4) }} {{ site.brandName }}.</div>
          <nav class="footerNav" aria-label="Links do site">
            <a href="/cidades/">Cidades</a>
            <a href="/termos-de-uso.html">Termos</a>
            <a href="/politica-de-privacidade.html">Privacidade</a>
          </nav>
        </div>
      </div>
    </footer>

    {% if (pageMeta.type == "fretes" or pageMeta.type == "mudancas" or pageMeta.type == "urgente") %}
      <div class="waDock" id="ctWaDock" aria-label="Atalho WhatsApp">
        <div class="wrap waDockInner">
          <a class="btn primary waDockBtn" data-ct-wa="1" data-wa-kind="dock" href="https://wa.me/{{ site.whatsAppNumberE164 | replace('+','') | replace(' ','') | replace('-','') | replace('(','') | replace(')','') }}?text={{ (site.whatsAppDefaultText or '') | urlencode }}">Chamar no WhatsApp</a>
        </div>
      </div>
    {% endif %}

    <script>
      (() => {
        try {
          // ===== UX wiring (sempre) =====
          // âncora contato: scroll suave e previsível
          try {
            document.addEventListener("click", (ev) => {
              const a = ev && ev.target && ev.target.closest ? ev.target.closest("a[href='#contato']") : null;
              if (!a) return;
              ev.preventDefault();
              const el = document.getElementById("contato");
              if (el && el.scrollIntoView) el.scrollIntoView({ behavior: "smooth", block: "start" });
            });
          } catch {}

          // força topbar/dock a usar o melhor link WA da página (com mensagem automática)
          function bestWhatsHref() {
            const best = document.querySelector("a[data-ct-wa='1'][data-wa-kind='fretes'], a[data-ct-wa='1'][data-wa-kind='mudancas'], a[data-ct-wa='1'][data-wa-kind='urgente'], a[data-ct-wa='1']");
            const href = best && best.getAttribute ? (best.getAttribute("href") || "") : "";
            return href;
          }
          try {
            const href = bestWhatsHref();
            if (href) {
              const top = document.querySelector("a[data-wa-kind='topbar']");
              if (top) top.setAttribute("href", href);
              const dock = document.getElementById("ctWaDock");
              const dockA = dock ? dock.querySelector("a") : null;
              if (dockA) dockA.setAttribute("href", href);
            }
          } catch {}

          // ===== Tracking (somente se endpoint válido) =====
          const endpoint = "{{ site.trackingEndpoint }}";
          if (!endpoint || !/^https?:\/\//i.test(endpoint)) return;

          const pageType = document.body.getAttribute("data-page-type") || "";
          const citySlug = document.body.getAttribute("data-city-slug") || "";
          const sidKey = "ct_site_sid_v1";
          let sid = "";
          try {
            sid = localStorage.getItem(sidKey) || "";
            if (!sid) {
              sid = (Math.random().toString(16).slice(2) + Date.now().toString(16)).slice(0, 48);
              localStorage.setItem(sidKey, sid);
            }
          } catch {}

          function beacon(event, extra) {
            try {
              const payload = Object.assign({
                v: 1,
                event,
                ts: Date.now(),
                sid,
                pageType,
                citySlug,
                path: location.pathname || "",
                ref: document.referrer || ""
              }, (extra || {}));
              const blob = new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" });
              navigator.sendBeacon(endpoint, blob);
            } catch {}
          }

          // pageview (sem bloquear a navegação)
          beacon("pageview");

          // whatsapp click (captura)
          document.addEventListener("click", (ev) => {
            const a = ev && ev.target && ev.target.closest ? ev.target.closest("a[data-ct-wa='1']") : null;
            if (!a) return;
            beacon("whatsapp_click", {
              href: a.getAttribute("href") || "",
              waKind: a.getAttribute("data-wa-kind") || ""
            });
          }, { capture: true });
        } catch {}
      })();
    </script>
  </body>
</html>

