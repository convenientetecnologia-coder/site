<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ seo.title }}</title>
    <meta name="description" content="{{ seo.description }}" />
    <link rel="canonical" href="{{ seo.canonical }}" />

    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ seo.ogTitle or seo.title }}" />
    <meta property="og:description" content="{{ seo.ogDescription or seo.description }}" />
    <meta property="og:url" content="{{ seo.canonical }}" />
    <meta property="og:image" content="{{ seo.ogImage or site.defaultOgImage }}" />

    {% if publish.mode != "production" %}
      <meta name="robots" content="noindex,nofollow" />
    {% else %}
      <meta name="robots" content="index,follow" />
    {% endif %}

    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/assets/site.css" />
  </head>
  <body data-page-type="{{ pageMeta.type or 'home' }}" data-city-slug="{{ pageMeta.citySlug or '' }}">
    <header class="top">
      <div class="wrap">
        <a class="brand" href="/">{{ site.brandName }}</a>
        {% set t = pageMeta.type or '' %}
        {% if t == "home" or t == "cidades" or t == "legal_privacy" or t == "legal_terms" %}
          <nav class="nav">
            <a href="#contato">Contato</a>
          </nav>
        {% else %}
          <nav class="nav">
            <a class="navCta" data-ct-wa="1" data-wa-kind="topbar" href="https://wa.me/{{ site.whatsAppNumberE164 | replace('+','') | replace(' ','') }}">WhatsApp</a>
          </nav>
        {% endif %}
      </div>
    </header>

    <main class="main">
      {{ content | safe }}
    </main>

    <footer class="footer" id="contato">
      <div class="wrap">
        <div class="muted">© {{ ("" | toISODate) | slice(0,4) }} {{ site.brandName }}.</div>
      </div>
    </footer>

    {% if (pageMeta.type == "fretes" or pageMeta.type == "mudancas" or pageMeta.type == "urgente") %}
      <div class="waDock" id="ctWaDock" aria-label="Atalho WhatsApp">
        <div class="wrap waDockInner">
          <a class="btn primary waDockBtn" data-ct-wa="1" data-wa-kind="dock" href="/#contato">Chamar no WhatsApp</a>
        </div>
      </div>
    {% endif %}

    <script>
      (() => {
        try {
          const endpoint = "{{ site.trackingEndpoint }}";
          if (!endpoint || !/^https?:\/\//i.test(endpoint)) return;

          const pageType = document.body.getAttribute("data-page-type") || "";
          const citySlug = document.body.getAttribute("data-city-slug") || "";
          const sidKey = "ct_site_sid_v1";
          let sid = "";
          try {
            sid = localStorage.getItem(sidKey) || "";
            if (!sid) {
              sid = (Math.random().toString(16).slice(2) + Date.now().toString(16)).slice(0, 48);
              localStorage.setItem(sidKey, sid);
            }
          } catch {}

          function beacon(event, extra) {
            try {
              const payload = Object.assign({
                v: 1,
                event,
                ts: Date.now(),
                sid,
                pageType,
                citySlug,
                path: location.pathname || "",
                ref: document.referrer || ""
              }, (extra || {}));
              const blob = new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" });
              navigator.sendBeacon(endpoint, blob);
            } catch {}
          }

          // pageview (sem bloquear a navegação)
          beacon("pageview");

          // whatsapp click (captura)
          document.addEventListener("click", (ev) => {
            const a = ev && ev.target && ev.target.closest ? ev.target.closest("a[data-ct-wa='1']") : null;
            if (!a) return;
            beacon("whatsapp_click", {
              href: a.getAttribute("href") || "",
              waKind: a.getAttribute("data-wa-kind") || ""
            });
          }, { capture: true });

          // dock: usa o melhor link de WhatsApp da página (primeiro botão da página)
          try {
            const dock = document.getElementById("ctWaDock");
            if (dock) {
              const best = document.querySelector("a[data-ct-wa='1'][data-wa-kind='fretes'], a[data-ct-wa='1'][data-wa-kind='mudancas'], a[data-ct-wa='1'][data-wa-kind='urgente'], a[data-ct-wa='1']");
              const dockA = dock.querySelector("a");
              if (best && dockA && best.getAttribute("href")) dockA.setAttribute("href", best.getAttribute("href"));
            }
          } catch {}

          // âncora contato: scroll suave e previsível
          try {
            document.addEventListener("click", (ev) => {
              const a = ev && ev.target && ev.target.closest ? ev.target.closest("a[href='#contato']") : null;
              if (!a) return;
              ev.preventDefault();
              const el = document.getElementById("contato");
              if (el && el.scrollIntoView) el.scrollIntoView({ behavior: "smooth", block: "start" });
            });
          } catch {}
        } catch {}
      })();
    </script>
  </body>
</html>

